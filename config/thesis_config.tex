% Define custom colors
\definecolor{hyperColor}{HTML}{0B3EE3}
\definecolor{tableGray}{HTML}{F5F5F7}
\definecolor{veryPeri}{HTML}{6667ab}

\definecolor{lightgray}{rgb}{.9,.9,.9}
\definecolor{darkgray}{rgb}{.4,.4,.4}
\definecolor{purple}{rgb}{0.65, 0.12, 0.82}
\definecolor{editorGray}{rgb}{1.0, 1.0, 1.0}
\definecolor{editorOcher}{rgb}{1, 0.5, 0} % #FF7F00 -> rgb(239, 169, 0)
\definecolor{editorGreen}{rgb}{0, 0.5, 0} % #007C00 -> rgb(0, 124, 0)

% Set chapter font size
\chapterfont{\fontsize{24}{22}\selectfont}

% Set line height
\linespread{1.5}

% Custom hyphenation rules
\hyphenation{
    data-base
    al-go-rithms
    soft-ware
}

\begin{filecontents*}{\jobname.xmpdata}
  \Title{SviluppAbile: un'estensione per sviluppare pagine web accessibili con l'aiuto di un chatbot}
  \Author{Elena Chilese} 
  \Language{it-IT}
  \Subject{Realizzazione di un'estensione web con integrazione di un chatbot IA per l'analizzare ed aiutare a creare pagine web accessibili}
  \Keywords{Accessibilità \sep Chatbot}
\end{filecontents*} 

% Images path
\graphicspath{{img/}}

% Force page color
\pagecolor{white}

% Better spacing for footnotes
\setlength{\skip\footins}{5mm}
\setlength{\footnotesep}{5mm}

% Fix header height warning
\setlength{\headheight}{27.11652pt}
\addtolength{\topmargin}{-12.61652pt}

% Add glossary subscript
\newcommand{\glox}{\textsubscript{\textbf{\textit{G}}}}

% Paragraph formatting
\titleformat{\paragraph}
{\normalfont\normalsize\bfseries}{\theparagraph}{1em}{}
\titlespacing*{\paragraph}
{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}

% Keep chapter format with "Chapter X" but modify spacing
\titleformat{\chapter}[display]
    {\normalfont\huge\bfseries}
    {\chaptertitlename\ \thechapter}
    {10pt}   % Reduced space between "Chapter X" and the title
    {\Huge}

% Reduce spacing before and after the chapter
\titlespacing*{\chapter}
    {0pt}    % left margin
    {-50pt}   % space before title (reduced from default 50pt)
    {20pt}   % space after title (reduced from default 40pt)

\newcommand{\chapterintroline}[1]{%
    \begin{quote}
    \normalfont
    #1
    \end{quote}
    \centerline{\rule{0.5\textwidth}{0.5pt}}  % Adds a horizontal line
}

% Page styling
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\leftmark}
\fancyfoot[C]{\thepage}

% Utility commands
\newcommand\blankpage{
\clearpage
    \begingroup
    \null
    \thispagestyle{empty}
    \hypersetup{pageanchor=false}
    \clearpage
\endgroup
}

\newcommand\blankpagewithnumber{
  \clearpage
  \thispagestyle{plain}
  \null
  \clearpage
}

\newcommand\increasepagenumbering{
    \addtocounter{page}{+1}
}

% Load glossaries
\input{references/glossary_acronyms}
\glsaddallunused
\makeglossaries
\renewcommand*{\glstextformat}[1]{\textit{#1}}

% Bibliography setup
\addbibresource{references/bibliography.bib}
\defbibheading{bibliography}{
    \cleardoublepage
    \phantomsection
    \addcontentsline{toc}{chapter}{\bibname}
    \chapter*{\bibname\markboth{\bibname}{\bibname}}
}

% Add this to suppress split bibliography warning
\BiblatexSplitbibDefernumbersWarningOff

% Hyperref setup
\hypersetup{
    colorlinks=true,
    linktocpage=true,
    pdfstartpage=1,
    pdfstartview=,
    breaklinks=true,
    pdfpagemode=UseNone,
    pageanchor=true,
    pdfpagemode=UseOutlines,
    plainpages=false,
    bookmarksnumbered,
    bookmarksopen=true,
    bookmarksopenlevel=1,
    hypertexnames=true,
    pdfhighlight=/O,
    allcolors = hyperColor
}

% Caption setup
\captionsetup{
    tableposition=top,
    figureposition=bottom,
    font=small,
    format=hang,
    labelfont=bf
}

% Adjust the way tables are handled
\setlength{\tabcolsep}{4pt}  % Default is 6pt, reducing gives more space in tables

% For longtable format
\setlength\LTleft{0pt}
\setlength\LTright{0pt}


\newcolumntype{L}[1]{>{\raggedright\arraybackslash}p{#1}}

% Adjust the way floats are handled to avoid excessive whitespace
\renewcommand{\topfraction}{0.9}        % Default 0.7
\renewcommand{\bottomfraction}{0.9}     % Default 0.3
\renewcommand{\textfraction}{0.1}       % Default 0.2
\renewcommand{\floatpagefraction}{0.85} % Default 0.5
\setcounter{topnumber}{3}              % Default 2
\setcounter{bottomnumber}{3}           % Default 1
\setcounter{totalnumber}{5}            % Default 3

% Enhanced color definitions for code
\definecolor{codeBackground}{HTML}{F8F9FA}
\definecolor{codeBorder}{HTML}{DEE2E6}
\definecolor{jsKeyword}{HTML}{D73A49}        % Red for keywords
\definecolor{jsString}{HTML}{032F62}         % Dark blue for strings
\definecolor{jsComment}{HTML}{6A737D}        % Gray for comments
\definecolor{jsNumber}{HTML}{005CC5}         % Blue for numbers
\definecolor{jsFunction}{HTML}{005041}       % Emerald for functions
\definecolor{jsVariable}{HTML}{E36209}       % Orange for variables
\definecolor{jsOperator}{HTML}{D73A49}       % Red for operators
\definecolor{lineNumbers}{HTML}{6A737D}      % Gray for line numbers

% Enhanced JavaScript language definition
\lstdefinelanguage{JavaScript}{
  keywords={
    % Control flow
    if, else, switch, case, default, break, continue, return,
    % Loops
    for, while, do, 
    % Functions and classes
    function, async, await, class, constructor, extends, super,
    % Variables
    var, let, const,
    % Types and values
    true, false, null, undefined, typeof, instanceof,
    % Error handling
    try, catch, finally, throw,
    % Others
    new, this, delete, in, of, with, debugger, export, import, from, as
  },
  keywordstyle=\color{jsKeyword}\bfseries,
  % Secondary keywords (built-in objects and methods)
  ndkeywords={
    % Built-in objects
    Array, Object, String, Number, Boolean, Date, RegExp, Math, JSON,
    console, window, document, setTimeout, setInterval, clearTimeout, clearInterval,
    Promise, Error, TypeError, ReferenceError,
    % Common methods
    log, push, pop, shift, unshift, slice, splice, map, filter, reduce, forEach,
    getElementById, querySelector, addEventListener, fetch, then, catch
  },
  ndkeywordstyle=\color{jsFunction}\bfseries,
  % Strings
  stringstyle=\color{jsString},
  morestring=[b]",
  morestring=[b]',
  morestring=[b]`,
  % Comments
  comment=[l]{//},
  morecomment=[s]{/*}{*/},
  commentstyle=\color{jsComment}\itshape,
  % Numbers
  sensitive=true,
  % Additional styling
  identifierstyle=\color{black},
  % Operators
  otherkeywords={
    =, +, -, *, /, \%, ==, ===, !=, !==, <, >, <=, >=, &&, ||, !, 
    +=, -=, *=, /=, ++, --, =>, ?, :, ;, \{, \}, [, ], (, )
  },
  % Special handling for template literals
  moredelim=[s][\color{jsString}]{`}{`}
}

% Enhanced HTML5 language definition (keeping your existing one but with better colors)
\lstdefinelanguage{HTML5}{
    language=html,
            sensitive=true, 
            alsoletter={<>=-},
            otherkeywords={
            % HTML tags
            <, </, >,
            </a, <a, </a>,
            </abbr, <abbr, </abbr>,
            </address, <address, </address>,
            </area, <area, </area>,
            </area, <area, </area>,
            </article, <article, </article>,
            </aside, <aside, </aside>,
            </audio, <audio, </audio>,
            </audio, <audio, </audio>,
            </b, <b, </b>,
            </base, <base, </base>,
            </bdi, <bdi, </bdi>,
            </bdo, <bdo, </bdo>,
            </blockquote, <blockquote, </blockquote>,
            </body, <body, </body>,
            </br, <br, </br>,
            </button, <button, </button>,
            </canvas, <canvas, </canvas>,
            </caption, <caption, </caption>,
            </cite, <cite, </cite>,
            </code, <code, </code>,
            </col, <col, </col>,
            </colgroup, <colgroup, </colgroup>,
            </data, <data, </data>,
            </datalist, <datalist, </datalist>,
            </dd, <dd, </dd>,
            </del, <del, </del>,
            </details, <details, </details>,
            </dfn, <dfn, </dfn>,
            </div, <div, </div>,
            </dl, <dl, </dl>,
            </dt, <dt, </dt>,
            </em, <em, </em>,
            </embed, <embed, </embed>,
            </fieldset, <fieldset, </fieldset>,
            </figcaption, <figcaption, </figcaption>,
            </figure, <figure, </figure>,
            </footer, <footer, </footer>,
            </form, <form, </form>,
            </h1, <h1, </h1>,
            </h2, <h2, </h2>,
            </h3, <h3, </h3>,
            </h4, <h4, </h4>,
            </h5, <h5, </h5>,
            </h6, <h6, </h6>,
            </head, <head, </head>,
            </header, <header, </header>,
            </hr, <hr, </hr>,
            </html, <html, </html>,
            </i, <i, </i>,
            </iframe, <iframe, </iframe>,
            </img, <img, </img>,
            </input, <input, </input>,
            </ins, <ins, </ins>,
            </kbd, <kbd, </kbd>,
            </keygen, <keygen, </keygen>,
            </label, <label, </label>,
            </legend, <legend, </legend>,
            </li, <li, </li>,
            </link, <link, </link>,
            </main, <main, </main>,
            </map, <map, </map>,
            </mark, <mark, </mark>,
            </math, <math, </math>,
            </menu, <menu, </menu>,
            </menuitem, <menuitem, </menuitem>,
            </meta, <meta, </meta>,
            </meter, <meter, </meter>,
            </nav, <nav, </nav>,
            </noscript, <noscript, </noscript>,
            </object, <object, </object>,
            </ol, <ol, </ol>,
            </optgroup, <optgroup, </optgroup>,
            </option, <option, </option>,
            </output, <output, </output>,
            </p, <p, </p>,
            </param, <param, </param>,
            </pre, <pre, </pre>,
            </progress, <progress, </progress>,
            </q, <q, </q>,
            </rp, <rp, </rp>,
            </rt, <rt, </rt>,
            </ruby, <ruby, </ruby>,
            </s, <s, </s>,
            </samp, <samp, </samp>,
            </script, <script, </script>,
            </section, <section, </section>,
            </select, <select, </select>,
            </small, <small, </small>,
            </source, <source, </source>,
            </span, <span, </span>,
            </strong, <strong, </strong>,
            </style, <style, </style>,
            </summary, <summary, </summary>,
            </sup, <sup, </sup>,
            </svg, <svg, </svg>,
            </table, <table, </table>,
            </tbody, <tbody, </tbody>,
            </td, <td, </td>,
            </template, <template, </template>,
            </textarea, <textarea, </textarea>,
            </tfoot, <tfoot, </tfoot>,
            </th, <th, </th>,
            </thead, <thead, </thead>,
            </time, <time, </time>,
            </title, <title, </title>,
            </tr, <tr, </tr>,
            </track, <track, </track>,
            </u, <u, </u>,
            </ul, <ul, </ul>,
            </var, <var, </var>,
            </video, <video, </video>,
            </wbr, <wbr, </wbr>,
            />, <!
  },  
  ndkeywords={
    % General
            =,
            % HTML attributes
            accept=, accept-charset=, accesskey=, action=, align=, alt=, async=, autocomplete=, autofocus=, autoplay=, autosave=, bgcolor=, border=, buffered=, challenge=, charset=, checked=, cite=, class=, code=, codebase=, color=, cols=, colspan=, content=, contenteditable=, contextmenu=, controls=, coords=, data=, datetime=, default=, defer=, dir=, dirname=, disabled=, download=, draggable=, dropzone=, enctype=, for=, form=, formaction=, headers=, height=, hidden=, high=, href=, hreflang=, http-equiv=, icon=, id=, ismap=, itemprop=, keytype=, kind=, label=, lang=, language=, list=, loop=, low=, manifest=, max=, maxlength=, media=, method=, min=, multiple=, name=, novalidate=, open=, optimum=, pattern=, ping=, placeholder=, poster=, preload=, pubdate=, radiogroup=, readonly=, rel=, required=, reversed=, rows=, rowspan=, sandbox=, scope=, scoped=, seamless=, selected=, shape=, size=, sizes=, span=, spellcheck=, src=, srcdoc=, srclang=, start=, step=, style=, summary=, tabindex=, target=, title=, type=, usemap=, value=, width=, wrap=,
            % CSS properties
            accelerator:,azimuth:,background:,background-attachment:,
            background-color:,background-image:,background-position:,
            background-position-x:,background-position-y:,background-repeat:,
            behavior:,border:,border-bottom:,border-bottom-color:,
            border-bottom-style:,border-bottom-width:,border-collapse:,
            border-color:,border-left:,border-left-color:,border-left-style:,
            border-left-width:,border-right:,border-right-color:,
            border-right-style:,border-right-width:,border-spacing:,
            border-style:,border-top:,border-top-color:,border-top-style:,
            border-top-width:,border-width:,bottom:,caption-side:,clear:,
            clip:,color:,content:,counter-increment:,counter-reset:,cue:,
            cue-after:,cue-before:,cursor:,direction:,display:,elevation:,
            empty-cells:,filter:,float:,font:,font-family:,font-size:,
            font-size-adjust:,font-stretch:,font-style:,font-variant:,
            font-weight:,height:,ime-mode:,include-source:,
            layer-background-color:,layer-background-image:,layout-flow:,
            layout-grid:,layout-grid-char:,layout-grid-char-spacing:,
            layout-grid-line:,layout-grid-mode:,layout-grid-type:,left:,
            letter-spacing:,line-break:,line-height:,list-style:,
            list-style-image:,list-style-position:,list-style-type:,margin:,
            margin-bottom:,margin-left:,margin-right:,margin-top:,
            marker-offset:,marks:,max-height:,max-width:,min-height:,
            min-width:,transition-duration:,transition-property:,
            transition-timing-function:,transform:,
            -moz-transform:,-moz-binding:,-moz-border-radius:,
            -moz-border-radius-topleft:,-moz-border-radius-topright:,
            -moz-border-radius-bottomright:,-moz-border-radius-bottomleft:,
            -moz-border-top-colors:,-moz-border-right-colors:,
            -moz-border-bottom-colors:,-moz-border-left-colors:,-moz-opacity:,
            -moz-outline:,-moz-outline-color:,-moz-outline-style:,
            -moz-outline-width:,-moz-user-focus:,-moz-user-input:,
            -moz-user-modify:,-moz-user-select:,orphans:,outline:,
            outline-color:,outline-style:,outline-width:,overflow:,
            overflow-X:,overflow-Y:,padding:,padding-bottom:,padding-left:,
            padding-right:,padding-top:,page:,page-break-after:,
            page-break-before:,page-break-inside:,pause:,pause-after:,
            pause-before:,pitch:,pitch-range:,play-during:,position:,quotes:,
            -replace:,richness:,right:,ruby-align:,ruby-overhang:,
            ruby-position:,-set-link-source:,size:,speak:,speak-header:,
            speak-numeral:,speak-punctuation:,speech-rate:,stress:,
            scrollbar-arrow-color:,scrollbar-base-color:,
            scrollbar-dark-shadow-color:,scrollbar-face-color:,
            scrollbar-highlight-color:,scrollbar-shadow-color:,
            scrollbar-3d-light-color:,scrollbar-track-color:,table-layout:,
            text-align:,text-align-last:,text-decoration:,text-indent:,
            text-justify:,text-overflow:,text-shadow:,text-transform:,
            text-autospace:,text-kashida-space:,text-underline-position:,top:,
            unicode-bidi:,-use-link-source:,vertical-align:,visibility:,
            voice-family:,volume:,white-space:,widows:,width:,word-break:,
            word-spacing:,word-wrap:,writing-mode:,z-index:,zoom:
  },
  keywordstyle=\color{jsKeyword}\bfseries,
  ndkeywordstyle=\color{jsFunction},
  morecomment=[s]{<!--}{-->},
  commentstyle=\color{jsComment}\itshape,
  stringstyle=\color{jsString},
  tag=[s]
}

% Enhanced global lstset configuration
\lstset{
  % Basic styling
  basicstyle=\ttfamily\footnotesize,
  backgroundcolor=\color{codeBackground},
  % Frame and spacing
  frame=single,
  framerule=0.5pt,
  rulecolor=\color{codeBorder},
  framesep=4pt,
  framexleftmargin=6pt,
  framextopmargin=4pt,
  framexbottommargin=4pt,
  % Line numbers
  numbers=left,
  numberstyle=\tiny\color{lineNumbers},
  numbersep=12pt,
  stepnumber=1,
  % Text formatting
  showstringspaces=false,
  showspaces=false,
  showtabs=false,
  tabsize=2,
  % Line breaking
  breaklines=true,
  breakatwhitespace=true,
  prebreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\hookleftarrow}},
  postbreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\hookrightarrow\space}},
  % Margins and positioning
  xleftmargin=20pt,
  xrightmargin=5pt,
  % Caption positioning
  captionpos=b,
  % Language settings
  language=JavaScript,
  alsolanguage=HTML5,
  % Extended character support
  extendedchars=true,
  inputencoding=utf8,
  % Special character handling
  literate=%
    {à}{{\'a}}1 {è}{{\'e}}1 {ì}{{\'i}}1 {ò}{{\'o}}1 {ù}{{\'u}}1
    {À}{{\'A}}1 {È}{{\'E}}1 {Ì}{{\'I}}1 {Ò}{{\'O}}1 {Ù}{{\'U}}1
    {Ã¤}{{\"{a}}}1 {Ã¶}{{\"{o}}}1 {Ã¼}{{\"{u}}}1
    {Ã„}{{\"{A}}}1 {Ã–}{{\"{O}}}1 {Ãœ}{{\"{U}}}1 {ÃŸ}{{\ss}}1
    {€}{{\euro}}1
}

% Specialized settings for different code types
\lstdefinestyle{jsStyle}{
  language=JavaScript,
  keywordstyle=\color{jsKeyword}\bfseries,
  stringstyle=\color{jsString},
  commentstyle=\color{jsComment}\itshape,
  numberstyle=\tiny\color{lineNumbers},
  identifierstyle=\color{black},
  emphstyle=\color{jsFunction}\bfseries
}

\lstdefinestyle{htmlStyle}{
  language=HTML5,
  keywordstyle=\color{jsKeyword}\bfseries,
  ndkeywordstyle=\color{jsFunction},
  stringstyle=\color{jsString},
  commentstyle=\color{jsComment}\itshape,
  numberstyle=\tiny\color{lineNumbers}
}